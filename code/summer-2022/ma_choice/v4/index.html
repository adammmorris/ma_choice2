<!doctype HTML>
<html>
<head>
	<title>Research Study</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
	<script src="https://www.google.com/recaptcha/api.js" async defer></script>
	<script src="papaparse.min.js"></script>
	<script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/jspsych-call-function.js"></script>
    <script src="jspsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych/plugins/jspsych-html-slider-response.js"></script>
    <script src='jspsych/plugins/jspsych-multiple-slider.js'></script>
    <script src='jspsych/plugins/jspsych-survey-likert.js'></script>
    <script src='jspsych/plugins/jspsych-instructions.js'></script>
    <script src='jspsych/plugins/jspsych-survey-text.js'></script>
    <script src='jspsych/plugins/jspsych-survey-multi-choice.js'></script>
    <script src='jspsych/plugins/jspsych-survey-multi-choice-twocol.js'></script>
    <script src='jspsych/plugins/jspsych-survey-multi-choice-twocol-slider.js'></script>
    <script src='jspsych/plugins/jspsych-survey-multi-choice-twocol-button.js'></script>
    <script src='jspsych/plugins/jspsych-survey-multi-select.js'></script>
    <script src='jspsych/plugins/jspsych-external-html.js'></script>
    <script src='jspsych/plugins/jspsych-maxdiff.js'></script>
    <script src='jspsych/plugins/jspsych-html-button-response.js'></script>
    <script src='jspsych/plugins/jspsych-html-button-response-machoice.js'></script>
    <script src='jspsych/plugins/jspsych-fullscreen.js'></script>
    <!--<script src='jspsych/plugins/jspsych-image-button-response.js'></script>-->
    <link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css">
    <link href="my.css" rel="stylesheet" type="text/css">
    <script src="utilities.js"></script>
    <script src="trialsets.js"></script>
    <style>
	td, th {padding: 20px;}
	.big {font-size: 40px;}
	.med {font-size: 24px;}
	</style>
</head>
<body>
</body>
<script>

// ***Setting Up the Experiment***

// Meta-var's
var study_version = "ma_choice_v4_real1"; // REMEMBER TO CHANGE THIS
var both_halves = true; // REMEMBER TO SET THIS TO TRUE FOR REAL VERSION

var turk_code = "JSALK23";
var study_time = 60;
var study_money = 6.67;

// var instr_reading_time = 2000; // in milliseconds
// var instructions_time = 0;

// // find the assignmentId & debugging status from the URL
var urlParams = parseURLParams(window.location.href);
var subject_id_url = '';
var debug = false;
if (typeof urlParams != "undefined") {
    if (urlParams.hasOwnProperty('PROLIFIC_PID')) {
        subject_id_url = urlParams.PROLIFIC_PID[0];
    }

    if (urlParams.hasOwnProperty('debug')) {
        debug = urlParams.debug[0];
    }
}


//added attributes to arrays-- other option is to create hashmap/dictionary
var yn =['No','Yes'];
var size = ['None', 'Small', 'Medium', 'Large', 'Very Large']; // yard, garage
var amount = ['Very Low', 'Low', 'Moderate', 'High', 'Very High']; // pollution, crime
var amount2 = ['Very Little', 'A Little', 'A Moderate Amount', 'A Lot']; // light, traffic
var prox1 = ['10 min away', '15 min away', '20 min away', '25 min away', '30 min away']; // parks, cafes/restaurants, public transportation
//var prox2 = ['10 min away', '30 min away', '50 min away', '70 min away', '90 min away']; // waterfront/beaches
var goodness = ['Very Bad', 'Bad', 'Moderate', 'Good', 'Very Good']; // reputation-school, climate

// if scale is null, must include postfix
var home_attributes = [
	//{name: 'Number of Bedrooms', scale: null, lb: 1, ub: 3, postfix: ' bdrm'},
	//{name: 'Size of garage', scale: size},
	{name: 'Closeness to parks', scale: prox1, min_diff: 2},
	//{name: 'Closeness to cafes/restaurants', scale: prox1, min_diff: 2},
	//{name: 'Closeness to public transportation', scale: prox1, min_diff: 2},
	//{name: 'Closeness to Waterfront/Beaches', scale: prox2},
	{name: 'Noise pollution', scale: amount, min_diff: 2},
	{name: 'Reputation of closest school', scale: goodness, min_diff: 2},
	//{name: 'Amount of natural light', scale: amount2, min_diff: 2},
	{name: 'Year building was built', scale: null, lb: 1950, ub: 2020, postfix: '', min_diff: 20, round_to: 1},
	//{name: 'Amount of crime in neighborhood', scale: amount, min_diff: 2},
	//{name: 'Reputation of landlord', scale: goodness},
	{name: 'Size of yard', scale: null, lb: 0, ub: 600, postfix: ' square feet', min_diff: 150, round_to: 50},
	//{name: 'Fireplace', scale: yn},
	{name: 'Quality of kitchen', scale: goodness, min_diff: 2},
	//{name: 'Washer/dryer in unit', scale: yn, min_diff: 1},
	{name: 'Quality of heat/AC system', scale: goodness, min_diff: 2},
	{name: 'Amount of traffic', scale: amount2, min_diff: 2},
	//{name: 'Weather in Area', scale: goodness},
	//{name: 'Hardwood Floors', scale: yn},
	//{name: 'Freshly Painted Exterior', scale: yn},
	{name: 'Size of home', scale: null, lb: 600, ub: 1800, postfix: ' square feet', min_diff: 200, round_to: 100},
];

var home_attribute_names = [];
for (i = 0; i < home_attributes.length; i++) {
	home_attribute_names.push(home_attributes[i].name);
}

var num_attributes_to_use = home_attributes.length;
var num_practice_trials = 10;
var num_trials = 100;
var num_practice_trials_to_use = num_practice_trials;
var num_trials_to_use = num_trials;
var trial_wait_time = 7000;
var num_attributes_to_ask_about = home_attributes.length;

if (debug) {
	num_practice_trials_to_use = 1;
	num_trials_to_use = 1;
	trial_wait_time = 0;
	//num_attributes_to_ask_about = 10;
}

function generateAttributeValues(cur_attributes){
	var arr = [];
	for (let j=0;j<cur_attributes.length;j++){
		cur_att = cur_attributes[j];
		if (cur_att.scale == null) {
			/*if (cur_att.postfix == null) {
				arr.push([cur_att.name,
					Math.floor(Math.random() * (cur_att.ub - cur_att.lb)) + cur_att.lb,
					Math.floor(Math.random() * (cur_att.ub - cur_att.lb)) + cur_att.lb]);
				} else {*/
			var rand1 = Math.floor(Math.random() * (cur_att.ub - cur_att.lb)) + cur_att.lb;
			var rand2 = -1;
			do {
				rand2 = Math.floor(Math.random() * (cur_att.ub - cur_att.lb)) + cur_att.lb;
			} while(Math.abs(rand2 - rand1) < cur_att.min_diff);
			arr.push([cur_att.name, Math.round(rand1/cur_att.round_to)*cur_att.round_to + cur_att.postfix, Math.round(rand2/cur_att.round_to)*cur_att.round_to + cur_att.postfix]);
				//}
		} else {
			var rand1 = Math.floor(Math.random() * cur_att.scale.length);
			var rand2 = -1;
			do {
				rand2 = Math.floor(Math.random() * cur_att.scale.length);
			} while(Math.abs(rand2 - rand1) < cur_att.min_diff);
			arr.push([cur_att.name, cur_att.scale[rand1], cur_att.scale[rand2]]);
		}
	}
return arr;
}

function generateTable(arr) {
	let tbl_html = "<div align='center'><table border = 2px solid black><thead>\
	</tr><tr><th></th><td><b>Home A</b></td><td><b>Home B</b></td>";

	for (var i = 0; i < arr.length; i++) {
		tbl_html += "<tr><th>"+arr[i][0]+"</th><td>"+arr[i][1]+"</td><td>"+arr[i][2]+"</td>";
	}

	tbl_html += '</tr></table><br>';

	//return "<div align='center'><table border = 2px solid black><thead></tr><tr><th></th><td><b>Home A</b></td><td><b>Home B</b></td><tr><th>"+arr[0][0]+"</th><td>"+arr[0][1]+"</td><td>"+arr[0][2]+"</td><tr><th>"+arr[1][0]+"</th><td>"+arr[1][1]+"</td><td>"+arr[1][2]+"</td></tr><tr><th>"+arr[2][0]+"</th><td>"+arr[2][1]+"</td><td>"+arr[2][2]+"</td></tr><tr><th>"+arr[3][0]+"</th><td>"+arr[3][1]+"</td><td>"+arr[3][2]+"</td></tr><tr><th>"+arr[4][0]+"</th><td>"+arr[4][1]+"</td><td>"+arr[4][2]+"</td></tr></table>"
	return tbl_html;
}

var start_instructions = 0;

// generate options from pre-set trial set
var trialset_opts1_json = Papa.parse(trialset_opts1, {header: true});
var trialset_opts2_json = Papa.parse(trialset_opts2, {header: true});

var trialset_practice = new Array(num_practice_trials);
for (var trial = 0; trial < num_practice_trials; trial++) {
	trialset_practice[trial] = new Array(num_attributes_to_use);
	var att_names = Object.keys(trialset_opts1_json.data[trial]);
	var att_vals1 = Object.values(trialset_opts1_json.data[trial]);
	var att_vals2 = Object.values(trialset_opts2_json.data[trial]);
	var flipped = Math.random() < 0.5; // whether to flip which one is Home A vs B for this trial
	var att_used_index = 0;
	for (var att = 0; att < att_names.length; att++) {
		if (home_attribute_names.includes(att_names[att])) {
			// find scale
			var home_att = home_attributes[home_attributes.findIndex(item => item.name == att_names[att])];
			var scale = home_att.scale;
			var first = flipped ? att_vals2[att] : att_vals1[att];
			var second = flipped ? att_vals1[att] : att_vals2[att];
			if (scale == null) {
				first = first + home_att.postfix;
			 	second = second + home_att.postfix;
			} else {
				first = scale[parseInt(first) - 1];
				second = scale[parseInt(second) - 1];
			}
			trialset_practice[trial][att_used_index] = [att_names[att], first, second];
			att_used_index++;
		}
	}

	trialset_practice[trial] = _.shuffle(trialset_practice[trial]);
}
trialset_practice = _.shuffle(trialset_practice);

var trialset = new Array(num_trials);
for (var trial = 0; trial < num_trials; trial++) {
	trialset[trial] = new Array(num_attributes_to_use);
	var att_names = Object.keys(trialset_opts1_json.data[num_practice_trials + trial]);
	var att_vals1 = Object.values(trialset_opts1_json.data[num_practice_trials + trial]);
	var att_vals2 = Object.values(trialset_opts2_json.data[num_practice_trials + trial]);
	var flipped = Math.random() < 0.5; // whether to flip which one is Home A vs B for this trial
	att_used_index = 0;
	for (var att = 0; att < att_names.length; att++) {
		if (home_attribute_names.includes(att_names[att])) {
			// find scale
			var home_att = home_attributes[home_attributes.findIndex(item => item.name == att_names[att])];
			var scale = home_att.scale;
			var first = flipped ? att_vals2[att] : att_vals1[att];
			var second = flipped ? att_vals1[att] : att_vals2[att];
			if (scale == null) {
				first = first + home_att.postfix;
			 	second = second + home_att.postfix;
			} else {
				first = scale[parseInt(first) - 1];
				second = scale[parseInt(second) - 1];
			}
			trialset[trial][att_used_index] = [att_names[att], first, second];
			att_used_index++;
		}
	}

	trialset[trial] = _.shuffle(trialset[trial]);
}
trialset = _.shuffle(trialset);

// ***Intro Blocks***

// credit to Tasuku Igarashi (https://github.com/tasukuigarashi/jspsych_recaptcha)
var recaptcha = {
    type: "external-html",
    url: "recaptcha.html",
    cont_btn: "submit_button",
    execute_script: true
};

var welcome = {
	type: 'instructions',
	pages: ['<b>Welcome to the ' + (both_halves ? 'first half of the ' : '') + 'research study on decision-making!</b>'],
	show_clickable_nav: true
}

var fullscreen = {
	type: "fullscreen",
	message: "We ask that you take this experiment in full screen mode. \
	When you click the 'Continue' button below, your browser will go full screen and you may start the study.<br><br>",
	fullscreen_mode: true,
};

var get_id = {
	type: 'survey-text',
	questions: [{prompt: "<b>Prolific ID:</b>", name: "worker_id"}],
	preamble: ["Please enter your <b>Prolific ID</b> below.<br>(When you're done, press <b>'Continue'</b>.)"],
};

var subject_id = '';
var get_id_loop = {
	timeline: [get_id],
	loop_function: function(data) {
		id = data.values()[0].response.worker_id;
		if (id) {
			jsPsych.data.addProperties({
				subject: id,
				version: study_version,
				assignmentId: subject_id_url
			});
			subject_id = id;

			// save att data
			for (var i = 0; i < home_attributes.length; i++) {
				att = home_attributes[i];
				att_data = {
					subject: id,
					version: study_version,
					assignmentId: subject_id_url,
					attribute: att.name,
					scale: att.scale == null ? '' : att.scale.toString(),
					min_diff: att.min_diff || null,
					lb: att.lb == undefined ? '' : att.lb,
					ub: att.ub == undefined ? '' : att.ub,
					postfix: att.postfix == undefined ? '' : att.postfix,
				}

				save_data(att_data, 'attributes');
			}

			start_instructions = Date.now();

			return false;
		} else {
			alert("Please provide your Prolific ID.");
			return true;
		}
	}
}

var check_consent = function(elem) {
	if ($('#consent_checkbox').is(':checked')) {
		return true;
	}
	else {
		alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
		return false;
	}
	return false;
};

var consent_block = {
	type:'external-html',
	url: "consent.php?time=" + study_time + "&money=" + study_money + "&test=1",
	cont_btn: "start",
	check_fn: check_consent,
	force_refresh: true
};

// first attention check
var attnCheck1 = {
    type: 'survey-text',
    questions: [{prompt: 'Your response', name: 'attention_check', required: debug ? false : true}],
    preamble: ["In order to complete this study, you will need to pay close attention for its entire duration. If you do not pay close attention, your data will be unusable.\
		<b>Please do not take this study unless you have time and energy to pay attention for the full length of time.</b>\
		<br><br>Please type this exact sentence into the box below: 'I will complete this study with my full attention.' and then continue."],
    on_finish: function(data) {
    	jsPsych.data.addProperties({attention_check: data.response.attention_check});
    }
};

// ***Welcome and Task 1 Instructions***
var instructions_text = ['Please <b>do not</b> press the <b>back</b> button or <b>refresh</b> your browser during the study; if you do, you will have to start over. <br><br> Please click <b>Next</b> and read the following instructions carefully. <br></br>',

 	'<br></br>This study has two sections. Each section should take about 25 minutes.',

	'<h2><u>Section 1</u></h2> In Section 1, you will make a series of choices. Each choice will be between <b>two homes that you might want to rent</b>.',

	"Each home will have a list of features that describe it. For instance, here are two homes that you might be asked to choose between:<br><br>\
	<img src='images/example_table.png' width='50%''></img>\
	<br><br><b>Your job will be to choose which home you'd rather rent.</b>",

	/*"The descriptions of the homes on each trial will be incomplete.\
	So for instance, on some trials, we might tell you about the age of the building and how close the home is to parks; \
	but on other trials, we might instead tell you information about the number of bedrooms and the reputation of the closest school.<br><br>\
	Your job is to use the information you have to make the best choice you can.",*/

	"We'll ask you to spend some time thinking about each choice before making it. On each trial, after " + trial_wait_time / 1000 + " seconds, two buttons will appear like this:<br><br>\
	<img src='images/example_buttons.png'></img><br><br>\
	You can take as much time as you need on each trial. When you're ready, select the button that corresponds to your choice (i.e. either Home A or Home B).",

	"On all trials, you should assume that the two homes (Homes A and B) <b>cost the same amount in rent</b>. They only differ on the features presented on the screen.<br><br>\
	Also, when making your choices, you should <b>assume that these are the only two homes available</b>. Sometimes the two homes might both be bad choices from your perspective. That's okay -- just do your best to choose the home you'd rather rent if those were your only two options.",

	"Let's give you some practice trials to get the hang of it. There will be " + num_practice_trials_to_use + " practice trials.<br><br>\
	When you're ready, please continue."
];

var instructions_times = Array();
 var instructions = {
	type: "instructions",
	pages: instructions_text,
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
}

var att_list = '<ul style="text-align: left">';
for (var i = 0; i < home_attributes.length; i++) {
	var cur_att = home_attributes[i];
	att_list += '<li style="list-style-type: none;">';
	att_list += '<b>' + cur_att.name + '</b>: ';
	var lower = '';
	var upper = '';
	var postfix = '';
	if (cur_att.scale == null) {
		lower = cur_att.lb;
		upper = cur_att.ub;
		postfix = cur_att.postfix;
	} else {
		lower = cur_att.scale[0];
		upper = cur_att.scale[cur_att.scale.length - 1];
	}
	att_list += lower + ' to ' + upper + ' ' + postfix;
	att_list += '</li>';
}
att_list += '</ul>';

var instructions2 = {
	type: 'instructions',
	pages: ["Great job. Let's move on to the real trials.",
		"Just to remind you, here's the full list of features that will differ across the two homes, along with the minimum and maximum values they can have:<br><br>" + att_list,
		"One last thing before you start. While you're making your choices, <b>please pay attention to how you're making them</b> -- i.e. how much the different factors are influencing your choice.",
		"There will be " + num_trials_to_use + " trials in total. Please do your best to pay attention throughout this whole section, and continue to make the best choice you can on each trial.<br><br>\
		When you're ready to start, press 'Next'."],
		show_clickable_nav: true,
		on_finish: function(data) {
			for (var i = 0; i < data.view_history.length; i++) {
				instructions_times.push(Math.round(data.view_history[i].viewing_time));
			}
		}
}

var practice_trials = [];
for (var i = 0; i < num_practice_trials; i++) {
	//var cur_attributes = jsPsych.randomization.sampleWithoutReplacement(home_attributes,num_attributes_to_use);
	//var attribute_values = generateAttributeValues(cur_attributes);
	var attribute_values = trialset_practice[i];
	var tbl = generateTable(attribute_values);

	practice_trials.push({
		 type: 'html-button-response-machoice',
		 stimulus: tbl,
		 choices: ['Home A','Home B'],
		 prompt: 'Which would you choose?<br><small>(Trial ' + (i+1) + ' out of ' + num_practice_trials_to_use + ')</small>',
		 button_duration: trial_wait_time, //how long to hide buttons
 		 data: {which_trial: i, att_values: attribute_values},
		 on_finish: function(data) {
		   att_names = [];
			 atts_opt1 = [];
			 atts_opt2 = [];

			 for (var i = 0; i < data.att_values.length; i++) {
				 att_names.push(data.att_values[i][0]);
				 atts_opt1.push(data.att_values[i][1]);
				 atts_opt2.push(data.att_values[i][2]);
			 }

			 s1_data = {
				 subject: data.subject,
				 version: data.version,
				 assignmentId: subject_id_url,
				 trial: data.which_trial,
				 practice: 1,
				 opt1_id: -1,
				 opt2_id: -1,
				 attributes: att_names.toString(),
				 opt1_values: atts_opt1.toString(),
				 opt2_values: atts_opt2.toString(),
				 choice: data.response,
				 rt: data.rt
			 }

			 save_data(s1_data, 's1');
		 }
	 });
}

var trials = [];
for (var i = 0; i < num_trials; i++) {
	//var cur_attributes = jsPsych.randomization.sampleWithoutReplacement(home_attributes,num_attributes_to_use);
	//var attribute_values = generateAttributeValues(cur_attributes);
	var attribute_values = trialset[i];
	var tbl = generateTable(attribute_values);

	trials.push({
		 type: 'html-button-response-machoice',
		 stimulus: tbl,
		 choices: ['Home A','Home B'],
		 prompt: 'Which would you choose?<br><small>(Trial ' + (i+1) + ' out of ' + num_trials_to_use + ')</small>',
		 button_duration: trial_wait_time, //how long to hide buttons
 		 data: {which_trial: i, att_values: attribute_values},
		 on_finish: function(data) {
			 att_names = [];
			 atts_opt1 = [];
			 atts_opt2 = [];

			 for (var i = 0; i < data.att_values.length; i++) {
				 att_names.push(data.att_values[i][0]);
				 atts_opt1.push(data.att_values[i][1]);
				 atts_opt2.push(data.att_values[i][2]);
			 }

			 s1_data = {
				 subject: data.subject,
				 version: data.version,
				 assignmentId: subject_id_url,
				 trial: data.which_trial,
				 practice: 0,
				 opt1_id: -1,
				 opt2_id: -1,
				 attributes: att_names.toString(),
				 opt1_values: atts_opt1.toString(),
				 opt2_values: atts_opt2.toString(),
				 choice: data.response,
				 rt: data.rt
			 }

			 save_data(s1_data, 's1');
		 }
	 });
}

var fixation = {
    type: 'html-keyboard-response',
    stimulus: '<span style="font-size:40px;">+</span>',
    choices: jsPsych.NO_KEYS,
    trial_duration: 1000
}

var question_rts = new Object();

//*** Survey Questions ***
var attribute_instructions = {
	type: 'instructions',
	pages: ["Great work. You've completed Section 1.",
	"<h2><u>Section 2</u></h2> Now, in Section 2, we are going to ask you to reflect on the decisions you just made in Section 1, and how you considered the various features of each home while making your choices.",
	],
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

// Overarching feature questions

var strat_instructions_intro = {
	type: 'instructions',
	pages: ["On the next few pages, we're going to ask you some questions about the <b>big-picture decision-making strategies</b> people might use when choosing between homes in Section 1.<br><br>\
	The strategies are not mutually exclusive, or all-or-nothing; people could be somewhere in the middle, or use one strategy on some trials and then another strategy on other trials. The strategies are meant to capture aspects of how people made their choices, not necessarily to describe their entire thought process. Just do your best to understand each strategy and answer the questions as accurately as you can."],
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

/*var strat_q_labels = ['<b>Strategy A much better</b> describes how <b>I</b> made my choices', '', '<b>Strategy A somewhat better</b> describes how <b>I</b> made my choices', '', '<b>Both strategies equally</b> describe how <b>I</b> made my choices', '', '<b>Strategy B somewhat better</b> describes how <b>I</b> made my choices', '', '<b>Strategy B much better</b> describes how <b>I</b> made my choices'];
var strat_q_labels_comp = ['<b>Strategy A much better</b> describes how this person made their choices', '', '<b>Strategy A somewhat better</b> describes how this person made their choices', '', '<b>Both strategies equally</b> describe how this person made their choices', '', '<b>Strategy B somewhat better</b> describes how this person made their choices', '', '<b>Strategy B much better</b> describes how this person made their choices'];
var strat_q_labels_norm = ['<b>Strategy A much better</b> describes how someone <b>SHOULD</b> make their choices', '', '<b>Strategy A somewhat better</b> describes how someone <b>SHOULD</b> make their choices', '', '<b>Both strategies equally</b> describe how someone <b>SHOULD</b> make their choices', '', '<b>Strategy B somewhat better</b> describes how someone <b>SHOULD</b> make their choices', '', '<b>Strategy B much better</b> describes how someone <b>SHOULD</b> make their choices'];
*/

function get_strat_labels(word1, word2, type) {
	var lbls = null;
	if (type == 'real') {
		lbls = ['<b>Strategy ' + word1 + ' much better</b> describes how <b>I</b> made my choices', '', '<b>Strategy ' + word1 + ' somewhat better</b> describes how <b>I</b> made my choices', '', '<b>Both strategies equally</b> describe how <b>I</b> made my choices', '', '<b>Strategy  ' + word2 + '  somewhat better</b> describes how <b>I</b> made my choices', '', '<b>Strategy  ' + word2 + '  much better</b> describes how <b>I</b> made my choices'];
	} else if (type == 'comp') {
		lbls = ['<b>Strategy ' + word1 + ' much better</b> describes how this person made their choices', '', '<b>Strategy ' + word1 + ' somewhat better</b> describes how this person made their choices', '', '<b>Both strategies equally</b> describe how this person made their choices', '', '<b>Strategy ' + word2 + ' somewhat better</b> describes how this person made their choices', '', '<b>Strategy ' + word2 + ' much better</b> describes how this person made their choices'];
	} else if (type == 'norm') {
		lbls = ['<b>Strategy ' + word1 + ' much better</b> describes how someone <b>SHOULD</b> make their choices', '', '<b>Strategy ' + word1 + ' somewhat better</b> describes how someone <b>SHOULD</b> make their choices', '', '<b>Both strategies equally</b> describe how someone <b>SHOULD</b> make their choices', '', '<b>Strategy ' + word2 + ' somewhat better</b> describes how someone <b>SHOULD</b> make their choices', '', '<b>Strategy ' + word2 + ' much better</b> describes how someone <b>SHOULD</b> make their choices'];
	}
	return(lbls);
}

var strat_preamble = 'Here are the two strategies described again, for reference.';
var strat_post_intro = "<br>When you feel like you've understood the two strategies, press 'Continue'.";

var strat_posts = [
'<br><b>Now</b>, read the following description of a person, and answer: <b>Which of the two strategies better reflects how this person made their choices?</b><br><br>',
'<br><b>Now</b>, read this description of a different person, and answer again: <b>Which of the two strategies better reflects how this person made their choices?</b><br><br>'
];

var strat_post_real = '<br><b>Next</b>, we want to know: Which of the two strategies better reflects how <b>YOU</b> made <b>YOUR</b> choices in Section 1 of the task?<br><br>';
var strat_post_norm = '<br><b>Finally</b>, we want to know: Which of the two strategies better reflects how someone <b>SHOULD</b> make choices in Section 1 of the task? Which is the right strategy, or the better one?<br><br>';

var strat_middle1 = {
	type: 'instructions',
	pages: ["Now, we're going to show you another two big-picture strategies.<br><br>When you're ready, press 'Next'."],
	show_clickable_nav: true
}

var strat_middle2 = {
	type: 'instructions',
	pages: ["Finally, we're going to show you the last two big-picture strategies.<br><br>When you're ready, press 'Next'."],
	show_clickable_nav: true
}

var strat_order_words = [['A', 'B'], ['C', 'D'], ['E', 'F']];
var strat_q_order = _.shuffle(['lex', 'binwts', 'binatts']);

var strat_instr = [[`First, we're going to describe two strategies -- <b>Strategy A</b> and <b>Strategy B</b> -- that a person could have used to make choices in Section 1.`],
									 [`Next, we're going to describe another two big-picture strategies -- <b>Strategy C</b> and <b>Strategy D</b> -- that a person could have used to make choices in Section 1.`],
									 [`Finally, we're going to describe a last two big-picture strategies -- <b>Strategy E</b> and <b>Strategy F</b> -- that a person could have used to make choices in Section 1.`]];
var strat_instr_trial = new Array(3);

for (var q = 0; q < 3; q++) {
	var strat_order_word = strat_order_words[q];

	if (strat_q_order[q] == 'lex') {
		var to_add = [
			"<b>Strategies " + strat_order_word[0] + "</b> and <b>" + strat_order_word[1] + "</b> are about the number of features of the homes that a person cared about when making their choices.",

			"A person using <b>Strategy " + strat_order_word[0] + "</b> made all their decisions based off a <b>single, all-important feature</b> and \
			did not consider the other features.\
			<br><br>For instance, if someone only cared about the size of the home (and no other features) when making all their decisions, their strategy might look like this:<div style='text-align: center'><img src='images/lex-strat-1.png' width=70%></div><br>\
			Of course, the person might have cared about a different feature than the one in this example. But the point is that they only cared about one feature throughout all their choices.",

			"In contrast, a person using <b>Strategy " + strat_order_word[1] + "</b> considered <b>multiple features</b> of the homes when making each of their decisions.<br><br>\
			For instance, if someone cared about the amount of traffic, the size of the home, and the noise pollution when making each of their decisions, their strategy might look like this: <div style='text-align: center'><img src='images/lex-strat-2.png' width=60%></div><br>\
			Of course, the person might have cared about different features than the ones in this example. But the point is that, during each choice, they cared about more than one feature."];

		var lex_options = [
			'The person made all their decisions based off a <b>single, all-important feature</b> and did not consider the other features.',
			'The person considered <b>multiple features</b> of the homes when making each of their choices.'];

	} else if (strat_q_order[q] == 'binwts') {
		var to_add = [
			"<b>Strategies " + strat_order_word[0] + "</b> and <b>" + strat_order_word[1] + "</b> are about how a person weighed together the features of the homes they cared about when making their choices.",

			"A person using <b>Strategy " + strat_order_word[0] + "</b> cared about some features of the homes and didn't care about others. Critically, for the features they did care about, they <b>cared about them all equally</b>.<br><br>\
			For instance, if the three features the person cared about were traffic, size of the home, and noise pollution, they cared about them <i>equally</i> when making their choices. \
			Their thinking might look like this: <div style='text-align: center'><img src='images/ew-strat-1.png' width=75%></div><br>\
			Of course, the person might have cared about different features (or a different number of features) than the ones in this example. Which features they cared about doesn't matter. \
			The point is that, for the features they <i>did</i> care about, they cared about them all an equal amount.",
			"Another way to put it is that, for <b>Strategy " + strat_order_word[0] + "</b>, the person either cared about a feature or didn't. There was no in-between (e.g. they didn't care about some features 'a little' versus 'a lot').",

			"In contrast, a person using <b>Strategy " + strat_order_word[1] + "</b> placed a <b>different amount of importance</b> on <b>different features they cared about</b>.<br><br>\
			For instance, if the three features the person considered were traffic, size of the home, and noise pollution, they cared about some of those features more than others when making their choices. \
			Their thinking might look like this: <div style='text-align: center'><img src='images/ew-strat-2.png' width=70%></div><br>\
			Of course, they might have cared about different features (or a different number of features) than the ones in this example. Which features they cared about doesn't matter. The point is that, for the features they <i>did</i> care about, they cared about some more than others.",
			"Another way to put it is that, for <b>Strategy " + strat_order_word[1] + "</b>, the person cared about some features a little and some features a lot."
		];

		var binwts_options = [
			"For the features the person cared about, the person <b>cared about them all equally</b>. (In other words, the person either cared about a feature or they didn't; there was no in-between.)",
			"For the features the person cared about, the person <b>placed a different amount of importance on different ones</b>. (In other words, the person might have cared about some features a little and some a lot.)"];
	} else if (strat_q_order[q] == 'binatts') {
		var to_add = [
			"<b>Strategies " + strat_order_word[0] + "</b> and <b>" + strat_order_word[1] + "</b> are about how a person compared the two homes on each feature.",

			"A person using <b>Strategy " + strat_order_word[0] + "</b> compared the homes on each feature based just on <b>which</b> home was better or worse on that feature, \
			but NOT <b>how much</b> better or worse it was.<br><br>\
			For instance, if the person was considering the size of each home, they only checked <i>which</i> home was bigger; \
		 	they didn't care about how <i>MUCH</i> bigger it was. Similarly, if the person was considering the amount of traffic near each home, they only checked which home had more traffic; they didn't care about how <i>much more</i> traffic it had. \
			Their thinking might look like this: <div style='text-align: center'><img src='images/wp-strat-1.png' width=45%></div><br>\
			In this case, it wouldn't matter whether Home A was 200 square feet bigger or 1000 square feet bigger; the person would treat them the same. All that matters to this person is that Home A is bigger.<br><br>\
			Of course, the person might have cared about different features than the ones in this example. But the point is that, for the features they did care about, they only considered which home was better or worse on each of those features (not how <i>much</i> better or worse it was).",
			"Another way to put it is that, for <b>Strategy " + strat_order_word[0] + "</b>, the person just checked whether a home 'won' on each feature, and didn't care about whether it won by a lot or a little.",

			"In contrast, a person using <b>Strategy " + strat_order_word[1] + "</b> went beyond checking which home was better or worse on each feature, and instead cared about <b>how much</b> better or worse it was.<br><br>\
			For instance, if the person was considering the size of each home or amount of traffic near each home, they cared about how <i>much</i> bigger the bigger home was, or how <i>much more</i> traffic it had. \
			Their thinking might look like this: <div style='text-align: center'><img src='images/wp-strat-2.png' width=90%></div><br>\
			Of course, the person might have cared about different features than the ones in this example. But the point is that, for the features they did care about, they considered how <i>much</i> better or worse each home was on those features."
		];

		var binatts_options = [
			"When the person compared the two homes on a feature, they only checked <b>which</b> home was better or worse on that feature (i.e. which home 'won' that feature), and didn't care about how much better or worse it was on that feature.",
			"When the person compared two homes on a feature, they cared about <b>how much</b> better or worse each home was on that feature."];
	}

	strat_instr[q] = strat_instr[q].concat(to_add);

	strat_instr_trial[q] = {
		type: 'instructions',
		pages: strat_instr[q],
		show_clickable_nav: true,
		on_finish: function(data) {
			for (var i = 0; i < data.view_history.length; i++) {
				instructions_times.push(data.view_history[i].viewing_time);
			}
		}
	};
}


/* LEX question */

var lex_comp_descriptions = [
	"<b>Person description:</b> When making his choices between homes in Section 1, Ricardo only cared about the amount of traffic; he always just chose whichever home had less traffic.",
 `<b>Person description:</b> When making her choices between homes in Section 1, Sarah cared about three features: closeness to parks, reputation of the closest school, and the quality of the heat/AC system. She cared about the school reputation the most, but also cared a little about the closeness to parks and the heat/AC quality.`
];

var lex_comp_answers = [0,100];
var lex_comp_numbers = [1,2];
shufflethree(lex_comp_descriptions, lex_comp_answers, lex_comp_numbers);

var lex_intro = {
    type: 'survey-multi-choice-twocol-button',
    preamble: strat_preamble,
		questions: function() {
			return ([{prompt: strat_post_intro, options: lex_options, horizontal: true, required: debug ? false : true}]);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
			instructions_times.push(Math.round(data.rt));
    }
};

var lex_comp1 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[0] + "<div class='diff-font'>" + lex_comp_descriptions[0] + "</div>", options: lex_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (lex_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: lex_comp_numbers[0], description: lex_comp_descriptions[0], answer: lex_comp_answers[0]},
		on_finish: function(data) {
      jsPsych.data.addProperties({lex_q_comp1: data.response});
	   	jsPsych.data.addProperties({lex_q_comp1_description: data.description});
	   	jsPsych.data.addProperties({lex_q_comp1_answer: data.answer});
	   	jsPsych.data.addProperties({lex_q_comp1_number: data.number});
			question_rts.lex_q_comp1 = Math.round(data.rt);
    }
};
var lex_comp2 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[1] + "<div class='diff-font'>" + lex_comp_descriptions[1] + "</div>", options: lex_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (lex_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: lex_comp_numbers[1], description: lex_comp_descriptions[1], answer: lex_comp_answers[1]},
		on_finish: function(data) {
      jsPsych.data.addProperties({lex_q_comp2: data.response});
	   	jsPsych.data.addProperties({lex_q_comp2_description: data.description});
	   	jsPsych.data.addProperties({lex_q_comp2_answer: data.answer});
	   	jsPsych.data.addProperties({lex_q_comp2_number: data.number});
			question_rts.lex_q_comp2 = Math.round(data.rt);
    }
};

var lex_real = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_real, options: lex_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (lex_labels_real);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({lex_q_real: data.response});
			question_rts.lex_q_real = Math.round(data.rt);
    }
};

var lex_norm = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_norm, options: lex_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (lex_labels_norm);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({lex_q_norm: data.response});
			question_rts.lex_q_norm = Math.round(data.rt);
    }
};

/* Binary weights question */

var binwts_comp_descriptions = [
	"<b>Person description:</b> When making her choices between homes in Section 1, Leila cared about two features: the amount of noise pollution and the amount of traffic. She cared about both of those two features an equal amount. To decide which home was better overall, she compared how much better each home was on those two features.",
 `<b>Person description:</b> When making her choices between homes in Section 2, Monica cared about four features: the size of the home, the size of the yard, the amount of traffic, and the amount of noise pollution. She cared about the size of the home and yard the most, but she also cared a little about the other two features.`
];

var binwts_comp_answers = [0,100];
var binwts_comp_numbers = [1,2];
shufflethree(binwts_comp_descriptions, binwts_comp_answers, binwts_comp_numbers);

var binwts_intro = {
    type: 'survey-multi-choice-twocol-button',
    preamble: strat_preamble,
		questions: function() {
			return ([{prompt: strat_post_intro, options: binwts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binwts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
			instructions_times.push(Math.round(data.rt));
    }
};

var binwts_comp1 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[0] + "<div class='diff-font'>" + binwts_comp_descriptions[0] + "</div>", options: binwts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binwts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: binwts_comp_numbers[0], description: binwts_comp_descriptions[0], answer: binwts_comp_answers[0]},
		on_finish: function(data) {
      jsPsych.data.addProperties({binwts_q_comp1: data.response});
	   	jsPsych.data.addProperties({binwts_q_comp1_description: data.description});
	   	jsPsych.data.addProperties({binwts_q_comp1_answer: data.answer});
	   	jsPsych.data.addProperties({binwts_q_comp1_number: data.number});
			question_rts.binwts_q_comp1 = Math.round(data.rt);
    }
};
var binwts_comp2 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[1] + "<div class='diff-font'>" + binwts_comp_descriptions[1] + "</div>", options: binwts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binwts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: binwts_comp_numbers[1], description: binwts_comp_descriptions[1], answer: binwts_comp_answers[1]},
		on_finish: function(data) {
      jsPsych.data.addProperties({binwts_q_comp2: data.response});
	   	jsPsych.data.addProperties({binwts_q_comp2_description: data.description});
	   	jsPsych.data.addProperties({binwts_q_comp2_answer: data.answer});
	   	jsPsych.data.addProperties({binwts_q_comp2_number: data.number});
			question_rts.binwts_q_comp2 = Math.round(data.rt);
    }
};

var binwts_real = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_real, options: binwts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binwts_labels_real);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({binwts_q_real: data.response});
			question_rts.binwts_q_real = Math.round(data.rt);
    }
};

var binwts_norm = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_norm, options: binwts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binwts_labels_norm);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({binwts_q_norm: data.response});
			question_rts.binwts_q_norm = Math.round(data.rt);
    }
};

/* Binary attributes question */

var binatts_comp_descriptions = [
	"<b>Person description:</b> When making his choices between homes in Section 1, Xavier cared about three features: the size of the home, the amount of traffic, and the closeness to parks. He checked which home was better on each feature (i.e. which home 'won' on each feature), and chose the home that 'won' on a majority of the three features.",
 `<b>Person description:</b> When making his choices between homes in Section 1, Joe cared about three features: the year the building was built, the closeness to parks, and the size of the yard. He considered the difference between the two homes on each feature (e.g. a 100 sq. ft. yard versus a 400 sq. ft. yard = a 300 sq. ft. difference), and then weighed those differences together to figure out which home was better overall.`
];

var binatts_comp_answers = [0,100];
var binatts_comp_numbers = [1,2];
shufflethree(binatts_comp_descriptions, binatts_comp_answers, binatts_comp_numbers);

var binatts_intro = {
    type: 'survey-multi-choice-twocol-button',
    preamble: strat_preamble,
		questions: function() {
			return ([{prompt: strat_post_intro, options: binatts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binatts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
			instructions_times.push(Math.round(data.rt));
    }
};

var binatts_comp1 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[0] + "<div class='diff-font'>" + binatts_comp_descriptions[0] + "</div>", options: binatts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binatts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: binatts_comp_numbers[0], description: binatts_comp_descriptions[0], answer: binatts_comp_answers[0]},
		on_finish: function(data) {
      jsPsych.data.addProperties({binatts_q_comp1: data.response});
	   	jsPsych.data.addProperties({binatts_q_comp1_description: data.description});
	   	jsPsych.data.addProperties({binatts_q_comp1_answer: data.answer});
	   	jsPsych.data.addProperties({binatts_q_comp1_number: data.number});
			question_rts.binatts_q_comp1 = Math.round(data.rt);
    }
};
var binatts_comp2 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[1] + "<div class='diff-font'>" + binatts_comp_descriptions[1] + "</div>", options: binatts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binatts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: binatts_comp_numbers[1], description: binatts_comp_descriptions[1], answer: binatts_comp_answers[1]},
		on_finish: function(data) {
      jsPsych.data.addProperties({binatts_q_comp2: data.response});
	   	jsPsych.data.addProperties({binatts_q_comp2_description: data.description});
	   	jsPsych.data.addProperties({binatts_q_comp2_answer: data.answer});
	   	jsPsych.data.addProperties({binatts_q_comp2_number: data.number});
			question_rts.binatts_q_comp2 = Math.round(data.rt);
    }
};

var binatts_real = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_real, options: binatts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binatts_labels_real);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({binatts_q_real: data.response});
			question_rts.binatts_q_real = Math.round(data.rt);
    }
};

var binatts_norm = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_norm, options: binatts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binatts_labels_norm);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({binatts_q_norm: data.response});
			question_rts.binatts_q_norm = Math.round(data.rt);
    }
};

// Consistency question1

var consistency_labels = ['0 <br>I changed my strategy on every trial', '1', '2 <br> I changed my strategy on some trials', '3', '4 <br> I was somewhere in the middle', '5', '6 <br> I used the same strategy on most trials', '7', '8<br>I used the same strategy on every trial'];

var consistency1 = {
    type: 'html-slider-response',
		require_movement: false,
		start: 0,
    stimulus: '<p>For the decision strategies you said you used, how consistently did you use these strategies throughout Section 1 of the experiment? <br>In other words, how much did the way you made your choices stay the same from trial to trial?</p>',
    labels: consistency_labels,
		on_finish: function(data) {
			jsPsych.data.addProperties({consistency1: data.response});

			question_rts.consistency1 = Math.round(data.rt);
		}
};

// **Attribute questions

var weight_instructions_intro = {
	type: 'instructions',
	pages: ["In this section, we want to know <b>how much you cared about each feature of the homes when making your decisions.</b><br><br>\
	For instance, we'll ask you how much you cared about the homes' closeness to parks when making your decisions, how much you cared about the reputation of the closest school, and so on.",
	"We'll ask you a bunch of different questions about this. Some of the questions might not accurately describe how you made your decisions. Other times, the questions might feel redundant or repetitive.<br><br>That's okay -- please <b>just do your best to answer each question as accurately as possible.</b>",
	"Also, we specifically want to know how much you cared about each feature <b>while making your decisions in Section 1</b>, NOT how much you care about each feature in real life.<br><br>\
	For instance, imagine that, in real life, you care a lot about the amount of traffic near your home -- but in this task, you didn't consider the amount of traffic at all in your choices. In that case, you would <b>say that you didn't care about the amount of traffic at all</b>."],
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

// WAD

var which_order_word = '';

var attr_instr_text_wad = [", we'll ask you <b>how much</b> you cared about each feature when making your decisions. Here's what the questions will look like:<br><br>\
<img src='images/example_introspection.png' width='35%' style='border: 1px solid #000000'></img><br><br>\
So if you didn't care about the size of the home at all, you'd move the slider to 0; if you cared a moderate amount, you'd move the slider to around 4; \
and if it completely determined your choice, you'd move the slider to 8. And you can move the slider anywhere in between.<br><br>\
When you're ready, press 'Next'."];

var attribute_instructions_wad = {
	type: 'instructions',
	pages: function() {
		return ([attr_instr_text_wad]);
	},
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

var label = ["0 <br> Didn't care about it at all", '1', '2 <br> Cared a little', '3', '4 <br> Cared somewhat', '5', '6 <br> Cared a lot', '7', '8<br>It completely determined my choices']
var prompt = '<br><br><br><br>How much did you care about this feature when making your decisions?';
var attribute_ratings = new Array(home_attributes.length);

for (var i = 0; i < home_attributes.length; i++) {
	att = home_attributes[i];
	attribute_ratings[i] = {
  	type: 'html-slider-response',
		labels: label,
  	stimulus: '<b>' + att.name + '</b>',
		prompt: prompt,
		max: 100,
		slider_start: 0,
	 	require_movement: false,
		data: {which_trial: i, attribute_name: att.name},
		on_finish: function(data) {
				s2_data = {
					subject: data.subject,
					version: data.version,
					assignmentId: subject_id_url,
					trial: data.which_trial,
					type: 'wad_att_rating',
					attribute: data.attribute_name,
					rating: data.response,
					rt: data.rt
				}

				save_data(s2_data, 's2');
		}
	};
}

attribute_ratings = _.shuffle(attribute_ratings);

// Attribute questions: EW

var attr_instr_text_ew = [", we'll ask <b>which</b> features of the homes you cared about when making your decisions. This is what the question will look like:<br><br>\
<img src='images/example_introspection_ew.png' width='65%' style='border: 1px solid #000000'></img><br><br>\
So if you cared about the amount of noise pollution and the amount of traffic, and didn't care about any of the other features, you'd check 'Amount of noise pollution' and 'Amount of traffic' and not check any of the others.<br><br>\
When you're ready, press 'Next'."];

var attribute_instructions_ew = {
	type: 'instructions',
	pages: function() {
		return ([attr_instr_text_ew]);
	},
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

home_attribute_names_ext = [...home_attribute_names];
//home_attribute_names_ext.push('I did not have a backup; I only made my choices based on the first attribute.')
var attribute_ratings_ew = {
		type: 'survey-multi-select',
		questions: [
			{prompt: '<b>Which features did you care about when making your choices?</b><br><br>(You can select as little as just 1 feature if you only cared about 1, or as many as all ' + num_attributes_to_use + ' features if you cared about all of them.)', options: home_attribute_names, required : debug ? false : true, horizontal: false}
		],
		preamble: '',
		on_finish: function(data) {
			var ans = data.response.Q0;

			for (var i = 0; i < ans.length; i++) {
					s2_data = {
						subject: data.subject,
						version: data.version,
						assignmentId: subject_id_url,
						trial: 0,
						type: 'ew_att_rating',
						attribute: ans[i],
						rating: 1,
						rt: data.rt
					}
				save_data(s2_data, 's2');
			}
		}
}


// Attribute questions: LEX

var attr_instr_text_lex = [", we'll ask <b>which single feature of the homes</b> you <u>MOST</u> used to make your decisions. \
The question will look like this:<br><br>\
<img src='images/example_introspection_lex.png' width='40%' style='border: 1px solid #000000'></img><br><br>\
For instance, maybe you primarily made your decision based on the homes' closeness to parks. If so, you would select 'Closeness to parks' for this question.<br><br>\
When you're ready, press 'Next'."];

var attribute_instructions_lex = {
	type: 'instructions',
	pages: function() {
		return ([attr_instr_text_lex]);
	},
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

//home_attribute_names_ext.push('I did not have a backup; I only made my choices based on the first attribute.')
var attribute_ratings_lex = {
		type: 'survey-multi-choice',
		questions: [
			{prompt: '<b>What single feature did you <u>MOST</u> use to make your choices?</b>', options: home_attribute_names, required : debug ? false : true, horizontal: false}
		],
		preamble: '',
		on_finish: function(data) {
				s2_data = {
					subject: data.subject,
					version: data.version,
					assignmentId: subject_id_url,
					trial: 0,
					attribute: data.response.Q0,
					type: 'lex_att_rating',
					rating: 1,
					rt: data.rt
				}
			save_data(s2_data, 's2');
		}
}

var appropriateness = {
    type: 'html-slider-response',
		require_movement: false,
    stimulus: `Great job.<br><p>Throughout Section 2, we've asked you various questions about how you made your choices in Section 1. <b>How well have these questions captured the way you made your choices?</b>
		Do you think that, by answering these questions, you've accurately and fully described how you made your choices in Section 1? Or are there important aspects of your decision-making process that we've missed?</p>`,
    labels: ['0<br>These questions totally failed to capture how I made my choices in Section 1', '1', '2', '3', '4', '5', '6', '7', '8 <br>These questions completely captured how I made my choices in Section 1'],
		on_finish: function(data) {
			jsPsych.data.addProperties({appropriateness: data.response});

			question_rts.appropriateness = Math.round(data.rt);
		}
};

var consistency_labels2 = ['0<br>The amount I cared about each feature changed on every trial', '1', '2<br>The amount I cared about each feature changed on some trials', '3', '4<br>I was somewhere in the middle', '5', '6<br>The amount I cared about each feature was the same on most trials', '7', '8<br>The amount I cared about each feature was the same on every trial'];

var consistency2 = {
    type: 'html-slider-response',
		require_movement: false,
    stimulus: '<p>On average, how consistent was the amount that you cared about each feature throughout Section 1 of the task? \
		<br>In other words, how much did the amount you cared about each feature stay the same from trial to trial?</p>',
    labels: consistency_labels2,
		on_finish: function(data) {
			jsPsych.data.addProperties({consistency2: data.response});

			question_rts.consistency2 = Math.round(data.rt);
		}
};

/* get directions */

var attr_instr_text_direction = [
	"Now, we'll ask you one more thing about the features of the homes.",

	"In Section 1, each feature of the homes had multiple values it could have taken on.<br><br>For instance, the size of the home could have been 600 square feet, 1200 square feet, etc.; \
	the amount of traffic could have been 'Very Little', 'A Little', 'Moderate', or 'A Lot'; and so on.",

	"<b>We want to know:</b> For each feature, which of these values would you have <span style='color: green'><b>most</b></span> preferred in a home (all else being equal)?\
	<br><br>Here's what the question will look like:<br><br><br>\
	<img src='images/example_introspection_direction1.png' width='90%' style='border: 1px solid #000000'></img><br><br><br>\
	So if 'Very Little' was your most preferred amount of traffic, you would select 'Very Little' for this question.",

	"We'll also ask: For each feature, which value would you have <span style='color: red'><b>least</b></span> preferred in a home (all else being equal)?\
	<br><br>Here's what the question will look like:<br><br><br>\
	<img src='images/example_introspection_direction2.png' width='100%' style='border: 1px solid #000000'></img><br><br><br>\
	So if 'A Lot' was your least preferred amount of traffic, you would select 'A Lot' for this question.",

	"When you're ready to start, press 'Next'."
];

var attribute_instructions_direction = {
	type: 'instructions',
	pages: attr_instr_text_direction,
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

var attribute_ratings_direction = new Array(home_attributes.length);
var last_trial_val = null;

for (var i = 0; i < home_attributes.length; i++) {
	att = home_attributes[i];
	var cur_scale = att.scale == null ? [att.lb + att.postfix, (Math.round((att.ub + att.lb) / 2)) + att.postfix, att.ub + att.postfix] : att.scale;

	attribute_ratings_direction[i] = new Array(2);

	attribute_ratings_direction[i][0] = {
		type: 'survey-multi-choice',
		questions: [
			{prompt: "When making your choices, which of these values would you have <span style='color: green'><b>most</b></span> preferred for '" + att.name + "'?", options: cur_scale, required: debug ? false : true, horizontal: true},
		],
		preamble: '<b>' + att.name + '</b><br><br>This feature could have taken on different values, such as: ' + cur_scale.join(', '),
	 	data: {which_trial: i, attribute_name: att.name},
		on_finish: function(data) {
			last_trial_val = data.response.Q0;
		}
	}

	attribute_ratings_direction[i][1] = {
		type: 'survey-multi-choice',
		questions: [
			{prompt: "When making your choices, which of these values would you have <span style='color: red'><b>least</b></span> preferred for '" + att.name + "'?", options: cur_scale, required: debug ? false : true, horizontal: true}
		],
		preamble: '<b>' + att.name + '</b><br><br>This feature could have taken on different values, such as: ' + cur_scale.join(', '),
	 	data: {which_trial: i, attribute_name: att.name},
		on_finish: function(data) {

			s2_data = {
				subject: data.subject,
				version: data.version,
				assignmentId: subject_id_url,
				trial: data.which_trial,
				attribute: data.attribute_name,
				type: 'direction',
				rating: -1,
				least_preferred: last_trial_val,
				most_preferred: data.response.Q0,
				rt: data.rt
			}

	 		save_data(s2_data, 's2');
		}
	}
}

attribute_ratings_direction = _.shuffle(attribute_ratings_direction);

var strategy = {
	type: 'survey-text',
	questions: [
	{prompt: "Please describe, in your own words, how you made your choices between homes in Section 1 of this study.", name: 'strategy', required: debug ? false : true, rows: 15, columns: 100},
	],
	on_finish: function(data) {
		jsPsych.data.addProperties({strategy: data.response.strategy});

		question_rts.strategy = Math.round(data.rt);
	}
};

var strategy2 = {
	type: 'survey-text',
	questions: [
	{prompt: "Before, we asked you to describe in your own words how you made your choices in Section 1. After answering all the questions in this section, how would you describe your strategy now? Has your description changed at all?", name: 'strategy2', required: debug ? false : true, rows: 15, columns: 100},
	],
	on_finish: function(data) {
		jsPsych.data.addProperties({strategy2: data.response.strategy2});

		question_rts.strategy2 = Math.round(data.rt);
	}
};

/* begin Part 3 */

var confidence = {
    type: 'html-slider-response',
		require_movement: false,
    stimulus: "Great job. Finally, we have some further questions for you about yourself and how you made choices in the experiment.<br><p>How confident are you that, when answering the questions in Section 2 of the task, you knew exactly how you made your choices in Section 1?</p>",
    labels: ['0<br>Not at all confident', '1', '2', '3', '4', '5', '6', '7', '8<br>Very confident'],
		on_finish: function(data) {
			jsPsych.data.addProperties({confidence: data.response});

			question_rts.confidence = Math.round(data.rt);
		}
};

var satisfaction = {
    type: 'html-slider-response',
		require_movement: false,
    stimulus: "How satisified are you with the choices you made between homes in Part 1 of the task? Do you think you made the best choices for yourself?</p>",
    labels: ['0<br>Not at all satisfied with my choices', '1', '2', '3', '4', '5', '6', '7', '8<br>Very satisfied with my choices'],
		on_finish: function(data) {
			jsPsych.data.addProperties({satisfaction: data.response});

			question_rts.satisfaction = Math.round(data.rt);
		}
};

var metastrategy = {
    type: 'survey-text',
    questions: [
      {prompt: "In Section 2 of this study, we asked you questions about how you made your choices in Section 1. How did you answer those questions in Section 2? In other words, how do you know what your Section 1 choice process was?", required: debug ? false : true, rows: 10, columns: 100}
    ],
  on_finish: function(data){
		jsPsych.data.addProperties({metastrategy: data.response.Q0});

		question_rts.metastrategy = Math.round(data.rt);
  }
};

var attention = {
	type: 'html-slider-response',
	require_movement: false,
    stimulus: "<p>How attentive were you throughout the experiment? (Please be honest; we understand that it's hard to focus throughout the study, and we will accept your submission no matter how you answer.)</p>",
    labels: ['0<br>Very Inattentive', '1', '2<br>Quite Inattentive', '3', '4<br>Moderate', '5', '6<br>Quite Attentive', '7', '8<br>Very Attentive'],
		on_finish: function(data) {
			jsPsych.data.addProperties({attention: data.response});

			question_rts.attention = Math.round(data.rt);
		}
};

var choice_exp_options = ["0","1-5","5-10","10-15","15+"];
var choice_exp = {
        type: 'html-button-response',
        stimulus: "<p>How many studies like this one (where you had to choose between two options which varied on many features) have you participated in before?</p>",
        choices: choice_exp_options,
				on_finish: function(data) {
					jsPsych.data.addProperties({choice_exp: choice_exp_options[data.response]});

					question_rts.choice_exp = Math.round(data.rt);
				}
    };

var choice_domain = {
	type: 'html-slider-response',
    stimulus: "In your life, how much time have you spent thinking about which houses or apartments to rent?",
    labels: ['0<br>Very little time', '1<br>Some time', '2<br>A lot of time', '3<br>Tons of time'],
		require_movement: false,
		on_finish: function(data) {
			jsPsych.data.addProperties({choice_domain: data.response});

			question_rts.choice_domain = Math.round(data.rt);
		}
};

var med_exp1 = null;
var meditation_experience1 = {
	type: 'survey-multi-choice',
    questions: [{prompt: "Have you tried mindfulness meditation in the past?", options: ['Yes', 'No'], required: debug ? false : true}],
		on_finish: function(data) {
			jsPsych.data.addProperties({meditation_exp1: data.response.Q0});
			med_exp1 = data.response.Q0;
		}
};

var med_exp2 = null;
var meditation_experience2 = {
	type: 'survey-multi-choice',
		questions: [{prompt: "For how many years have you practiced mindfulness meditation?", options: ['Less than 1 year', 'Between 1-5 years', 'More than 5 years'], required: debug ? false : true}],
		required: debug ? false : true,
		on_finish: function(data) {
			if (med_exp1 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp2: data.response.Q0});
				med_exp2 = data.response.Q0;
			}
		},
		skip: function() {return (med_exp1 == 'Yes' ? false : true)}
};

var meditation_experience3 = {
	type: 'survey-text',
		questions: [{prompt: "How many times have you practiced mindfulness meditation in the past 30 days? (Please enter a number below.)", required: debug ? false : true}],
		required: debug ? false : true,
		on_finish: function(data) {
			if (med_exp1 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp3: data.response.Q0});
				med_exp3 = data.response.Q0;
			}
		},
		skip: function() {return (med_exp1 == 'Yes' ? false : true)}
};

var meditation_experience4 = {
	type: 'survey-text',
		questions: [{prompt: "In the past 30 days, on average, how many minutes did you spend meditating in each session? (Please enter a number below.)", required: debug ? false : true}],
		required: debug ? false : true,
		on_finish: function(data) {
			if (med_exp1 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp4: data.response.Q0});
				med_exp4 = data.response.Q0;
			}
		},
		skip: function() {return (med_exp1 == 'Yes' ? false : true)}
};

var meditation_experience5 = {
	type: 'survey-multi-choice',
		questions: [{prompt: "Have you ever received mindfulness training or participated in a mindfulness/acceptance-based therapy program?", options: ['Yes', 'No'], required: debug ? false : true}],
		required: debug ? false : true,
		on_finish: function(data) {
			if (med_exp1 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp5: data.response.Q0});
				med_exp5 = data.response.Q0;
			}
		},
		skip: function() {return (med_exp1 == 'Yes' ? false : true)}
};

var meditation_experience6 = {
	type: 'survey-multi-choice',
		questions: [{prompt: "Select the option that best describes your experience with mindfulness meditation.", options: ['I am relatively new to mindfulness meditation.', 'I have a moderate amount of experience with mindfulness meditation.', 'I have an extensive amount of experience with mindfulness meditation.'], required: debug ? false : true, horizontal: false}],
		required: debug ? false : true,
		on_finish: function(data) {
			if (med_exp1 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp6: data.response.Q0});
				med_exp6 = data.response.Q0;
			}
		},
		skip: function() {return (med_exp1 == 'Yes' ? false : true)}
};


/*var meditation_experience6 = {
	type: 'survey-multi-choice',
		questions: [{prompt: "Did you see an individual therapist or participate in group-based therapy?", options: ['Yes', 'No'], required: debug ? false : true}],
		required: debug ? false : true,
		on_finish: function(data) {
			if (med_exp1 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp6: data.response.Q0});
				med_exp6 = data.response.Q0;
			}
		},
		skip: function() {return (med_exp1 == 'Yes' ? false : true)}
};*/

/*var meditation_experience3 = {
	type: 'survey-multi-choice',
    questions: [
			{prompt: `<hr>How often do you meditate (or do a mindfulness practice) <b>currently</b>?`,
			 options: ['Daily or almost daily', '2-4 times per week', 'About once per week', 'Less than once per week'],
			 required: debug ? false : true},
			{prompt: `<hr>On days when you meditate (or do a mindfulness practice), how long do you do it for?`,
			 options: ['5-15 minutes per day', '15-30 minutes per day', '>30 minutes per day'],
		 	required: debug ? false : true},
			{prompt: `<hr>For how many years have you been meditating (or doing a mindfulness practice) at this frequency and duration?`,
			 options: ['0-1 years', '1-3 years', '3-5 years', `5+ years`],
		 	required: debug ? false : true}
		],
		on_finish: function(data) {
			if (med_exp1 == 'Yes' && med_exp2 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp3: Object.values(data.response).join()});
			}
		},
		skip: function() {return (med_exp1 == 'Yes' && med_exp2 == 'Yes' ? false : true)}
};

var meditation_experience4 = {
	type: 'survey-multi-choice',
    questions: [
			{prompt: `<hr>When you did meditate (or do a mindfulness practice), how often did you do it?`,
			 options: ['Daily or almost daily', '2-4 times per week', 'About once per week', 'Less than once per week'],
			 required: debug ? false : true},
			{prompt: `<hr>When you did meditate (or do a mindfulness practice), how long did you do it for on the days you did it?`,
			 options: ['5-15 minutes per day', '15-30 minutes per day', '>30 minutes per day'],
		 	required: debug ? false : true},
			{prompt: `<hr>For how many years did you meditate (or do a mindfulness practice) at this frequency and duration?`,
			 options: ['0-1 years', '1-3 years', '3-5 years', `5+ years`],
		 	required: debug ? false : true}
		],
		on_finish: function(data) {
			if (med_exp1 == 'Yes' && med_exp2 == 'No') {
				jsPsych.data.addProperties({meditation_exp3: Object.values(data.response).join()});
			}
		},
		skip: function() {return (med_exp1 == 'Yes' && med_exp2 == 'No' ? false : true)}
};*/

var gen_choices = ['Man', 'Woman','Some other way', 'Prefer not to say'];
var gen = {
	type: 'survey-multi-choice',
	preamble: "Finally, we'll ask you to input some demographic information.",
	questions: [{prompt: "<b>Gender:</b> Do you describe yourself as a man, a woman, or in some other way?", options: gen_choices,
		required: false}],
	on_finish: function(data){
		jsPsych.data.addProperties({gender: data.response.Q0});
	}
};

var age_years = {
		type: 'survey-text',
		questions: [
			{prompt: "Age:", required: false, name: 'age'}
		],
	on_finish: function(data){
		jsPsych.data.addProperties({age: data.response.age});
	}
};

var race_options = ['White', 'Hispanic, Latinx, or Spanish origin', 'Black or African American', 'Asian', 'American Indian or Alaska Native', 'Middle Eastern or North African', 'Native Hawaiian or Other Pacific Islander', 'Some other race, ethnicity, or origin', 'Prefer not to say'];
var race = {
	type: 'survey-multi-select',
	questions: [{prompt: '<b>Race/ethnicity</b>: Which categories below describe you? Please select all that apply.', options: race_options,
		required: false}],
	on_finish: function(data){
		jsPsych.data.addProperties({race: JSON.stringify(data.response.Q0)});
	}
};


var nativeEng_options = ['Yes', 'No', 'Prefer not to say'];
var nativeEng = {
	type: 'html-button-response',
	stimulus: 'Is English your first language?<br>',
	choices: nativeEng_options,
	on_finish: function(data){
		jsPsych.data.addProperties({nativeEng: nativeEng_options[data.response]});
	}
};

var edu_options = ["Some high school","High school", "Some college", "2 year degree", "4 year degree", "Postgraduate/Professional degree/other", "Prefer not to say"];
var edu = {
	type: 'html-button-response',
	stimulus: 'What is the highest level of education that you have completed?<br>',
	choices: edu_options,
	on_finish: function(data){
		jsPsych.data.addProperties({edu: edu_options[data.response]});
	}
};

var income_options = ['Under $5,000', '$5,000 - $10,000', '$10,000 - $15,000', '$15,000 - $25,000', '$25,000 - $35,000', '$35,000 - $50,000', '$50,000 - $65,000', '$65,000 - $80,000', '$80,000 - $100,000', 'Over $100,000', 'Prefer not to say'];
var income = {
	type: 'html-button-response',
	stimulus: 'What was the total amount of income you earned during the last year?<br>',
	choices: income_options,
	on_finish: function(data){
		jsPsych.data.addProperties({income: income_options[data.response]});
	}
};

var permission = {
	type: 'survey-multi-choice',
	preamble: ["Earlier in the task, we asked you several questions about how you made your choices between homes in Section 1 of this study.<br><br>\
	At some point in the future, we may want to anonymously quote some of your responses to these questions in other studies, or in scientific publications resulting from this research. \
	Do you wish to give us permission to quote your answers? The quoted content would be <b>completely anonymous</b> and would not contain any information that could be linked back to you in any way. If you do not wish to have your answers to these questions quoted, you can select 'No' and there will not be any negative consequences."],
	questions: [{prompt: '', options: ['Yes, I am okay with my answers to these questions being quoted anonymously.', 'No, please do not quote my answers to these questions.'],
		required: debug ? false : true, horizontal: false, use_default: true}],
	on_finish: function(data){
		jsPsych.data.addProperties({permission: data.response.Q0});
	}
};

var feedback = {
	type: 'survey-text',
	questions: [
	{prompt: "Thanks for participating! Do you have any feedback for us about the study? Was there anything confusing? Did it take about as much time as we said it would?",
		name: 'feedback', required: false, rows: 15, columns: 100},
	],
	on_finish: function(data) {
		jsPsych.data.addProperties({feedback: data.response.feedback});

		demo_data = {
			subject: data.subject,
			version: data.version,
			assignmentId: subject_id_url,
			lex_real: checkvar(data.lex_q_real),
			lex_norm: checkvar(data.lex_q_norm),
			lex_comp1: checkvar(data.lex_q_comp1),
			lex_comp1_number: checkvar(data.lex_q_comp1_number),
			lex_comp1_description: checkvar(data.lex_q_comp1_description, 400),
			lex_comp1_answer: checkvar(data.lex_q_comp1_answer),
			lex_comp2: checkvar(data.lex_q_comp2),
			lex_comp2_number: checkvar(data.lex_q_comp2_number),
			lex_comp2_description: checkvar(data.lex_q_comp2_description, 400),
			lex_comp2_answer: checkvar(data.lex_q_comp2_answer),
			binwts_real: checkvar(data.binwts_q_real),
			binwts_norm: checkvar(data.binwts_q_norm),
			binwts_comp1: checkvar(data.binwts_q_comp1),
			binwts_comp1_number: checkvar(data.binwts_q_comp1_number),
			binwts_comp1_description: checkvar(data.binwts_q_comp1_description, 400),
			binwts_comp1_answer: checkvar(data.binwts_q_comp1_answer),
			binwts_comp2: checkvar(data.binwts_q_comp2),
			binwts_comp2_number: checkvar(data.binwts_q_comp2_number),
			binwts_comp2_description: checkvar(data.binwts_q_comp2_description, 400),
			binwts_comp2_answer: checkvar(data.binwts_q_comp2_answer),
			binatts_real: checkvar(data.binatts_q_real),
			binatts_norm: checkvar(data.binatts_q_norm),
			binatts_comp1: checkvar(data.binatts_q_comp1),
			binatts_comp1_number: checkvar(data.binatts_q_comp1_number),
			binatts_comp1_description: checkvar(data.binatts_q_comp1_description, 400),
			binatts_comp1_answer: checkvar(data.binatts_q_comp1_answer),
			binatts_comp2: checkvar(data.binatts_q_comp2),
			binatts_comp2_number: checkvar(data.binatts_q_comp2_number),
			binatts_comp2_description: checkvar(data.binatts_q_comp2_description, 400),
			binatts_comp2_answer: checkvar(data.binatts_q_comp2_answer),
			confidence: checkvar(data.confidence),
			satisfaction: checkvar(data.satisfaction),
			strategy: checkvar(data.strategy, 2000),
			strategy2: checkvar(data.strategy2, 2000),
			consistency1: checkvar(data.consistency1),
			consistency2: checkvar(data.consistency2),
			appropriateness: checkvar(data.appropriateness),
			attention: checkvar(data.attention),
			choice_exp: checkvar(data.choice_exp, 50),
			choice_domain: checkvar(data.choice_domain),
			meditation_exp1: checkvar(data.meditation_exp1, 10),
			meditation_exp2: checkvar(data.meditation_exp2, 50),
			meditation_exp3: checkvar(data.meditation_exp3, 100),
			meditation_exp4: checkvar(data.meditation_exp4, 100),
			meditation_exp5: checkvar(data.meditation_exp5, 10),
			meditation_exp6: checkvar(data.meditation_exp6, 100),
			metastrategy: checkvar(data.metastrategy, 2000),
			question_rts: checkvar(JSON.stringify(question_rts), 1000),
			gender: checkvar(data.gender, 50),
			age: checkvar(data.age, 50),
			race: checkvar(data.race, 50),
			edu: checkvar(data.edu, 50),
			income: checkvar(data.income, 50),
			nativeEng: checkvar(data.nativeEng, 50),
			permission: checkvar(data.permission, 50),
			feedback: checkvar(data.feedback, 1000),
			attention_check: checkvar(data.attention_check, 100),
			instructions_times: checkvar(JSON.stringify(instructions_times), 1000),
			section2_order: checkvar(section2_order.toString(),50),
			strat_q_order: checkvar(strat_q_order.toString(),50),
			weight_q_order: checkvar(weight_q_order.toString(),50),
			total_time: Date.now() - start_instructions
		}

		save_data(demo_data, 'demo');
	}
};

var debrief = {
	type: 'instructions',
	pages: ["You're done with the " + (both_halves ? 'first half of the study! Within 24 hours, you will be invited to take the second half of the study. <b><u>Please remember to take the second half of the study!</u></b> In addition to the base pay, it will offer a $1 completion bonus.' : 'study!') + "<br><br>\
	Click 'Next' to receive your Prolific completion code."],
	show_clickable_nav: true
};

var exit_fullscreen = {
  type: 'fullscreen',
  fullscreen_mode: false,
  delay_after: 0
}

var check_end = function(elem) {
	if ($('#end_checkbox').is(':checked')) {
	return true;
	} else {
	alert("Make sure to copy the code.");
	return false;
	}
	return false;
};

//var end = {
//type: 'external-html',
//url: "end.php?turkcode=" + turk_code + "&test=1",
//cont_btn: "end",
//check_fn: check_end,
//force_refresh: true
//};


var timeline = []


var section2_order = _.shuffle(['features', 'weights']);
var weight_q_order = _.shuffle(['wad', 'ew', 'lex']);

// INTRO
//timeline.push(recaptcha);
timeline.push(get_id_loop);
timeline.push(welcome);
if (!debug) {
	timeline.push(fullscreen);
	timeline.push(consent_block);
	timeline.push(attnCheck1);
}

// PART 1
timeline.push(instructions);
for (var t = 0; t < num_practice_trials_to_use; t++) {
	timeline.push(fixation);
	timeline.push(practice_trials[t]);
}
timeline.push(instructions2);
for (var t = 0; t < num_trials_to_use; t++) {
	timeline.push(fixation);
	timeline.push(trials[t]);
}

// PART 2: process questions
timeline.push(attribute_instructions);

timeline.push(strategy);

for (var k = 0; k < section2_order.length; k++) {
	if (section2_order[k] == 'features') {
		timeline.push(strat_instructions_intro);
		for (var q = 0; q < 3; q++) {
			var strat_order_word = strat_order_words[q];
			timeline.push(strat_instr_trial[q]);

			if (strat_q_order[q] == 'lex') {
				lex_options[0] = "<u><b>Strategy " + strat_order_word[0] + ":</b></u> " + lex_options[0];
				lex_options[1] = "<u><b>Strategy " + strat_order_word[1] + ":</b></u> " + lex_options[1];
				var lex_labels_comp = get_strat_labels(strat_order_word[0], strat_order_word[1], 'comp');
				var lex_labels_real = get_strat_labels(strat_order_word[0], strat_order_word[1], 'real');
				var lex_labels_norm = get_strat_labels(strat_order_word[0], strat_order_word[1], 'norm');
				timeline.push(lex_intro);
				timeline.push(lex_comp1);
				timeline.push(lex_comp2);
				timeline.push(lex_real);
				timeline.push(lex_norm);
			} else if (strat_q_order[q] == 'binwts') {
				binwts_options[0] = "<u><b>Strategy " + strat_order_word[0] + ":</b></u> " + binwts_options[0];
				binwts_options[1] = "<u><b>Strategy " + strat_order_word[1] + ":</b></u> " + binwts_options[1];
				var binwts_labels_comp = get_strat_labels(strat_order_word[0], strat_order_word[1], 'comp');
				var binwts_labels_real = get_strat_labels(strat_order_word[0], strat_order_word[1], 'real');
				var binwts_labels_norm = get_strat_labels(strat_order_word[0], strat_order_word[1], 'norm');
				timeline.push(binwts_intro);
				timeline.push(binwts_comp1);
				timeline.push(binwts_comp2);
				timeline.push(binwts_real);
				timeline.push(binwts_norm);
			} else if (strat_q_order[q] == 'binatts') {
				binatts_options[0] = "<u><b>Strategy " + strat_order_word[0] + ":</b></u> " + binatts_options[0];
				binatts_options[1] = "<u><b>Strategy " + strat_order_word[1] + ":</b></u> " + binatts_options[1];
				var binatts_labels_comp = get_strat_labels(strat_order_word[0], strat_order_word[1], 'comp');
				var binatts_labels_real = get_strat_labels(strat_order_word[0], strat_order_word[1], 'real');
				var binatts_labels_norm = get_strat_labels(strat_order_word[0], strat_order_word[1], 'norm');
				timeline.push(binatts_intro);
				timeline.push(binatts_comp1);
				timeline.push(binatts_comp2);
				timeline.push(binatts_real);
				timeline.push(binatts_norm);
			}
		}
		timeline.push(consistency1);
	} else if (section2_order[k] == 'weights') {
		// weight questions
		timeline.push(weight_instructions_intro);
		var order_words = ['First', 'Second', 'Third'];
		for (var i = 0; i < 3; i++) {
			which_order_word = order_words[i];
			if (weight_q_order[i] == 'wad') {
				attr_instr_text_wad = which_order_word + attr_instr_text_wad;
				timeline.push(attribute_instructions_wad);
				for (var j = 0; j < num_attributes_to_ask_about; j++) {
					timeline.push(attribute_ratings[j]);
				}
			} else if (weight_q_order[i] == 'ew') {
				attr_instr_text_ew = which_order_word + attr_instr_text_ew;
				timeline.push(attribute_instructions_ew);
				timeline.push(attribute_ratings_ew);
			} else if (weight_q_order[i] == 'lex') {
				attr_instr_text_lex = which_order_word + attr_instr_text_lex;
				timeline.push(attribute_instructions_lex);
				timeline.push(attribute_ratings_lex);
			}
		}
		timeline.push(consistency2);
	}
}

timeline.push(appropriateness);

timeline.push(attribute_instructions_direction);
for (var i = 0; i < num_attributes_to_ask_about; i++) {
	timeline.push(attribute_ratings_direction[i][0]);
	timeline.push(attribute_ratings_direction[i][1]);
}

timeline.push(strategy2);

// PART 3
timeline.push(confidence);
timeline.push(satisfaction);
timeline.push(metastrategy);
timeline.push(attention);
timeline.push(choice_domain);
timeline.push(choice_exp);
timeline.push(meditation_experience1);
timeline.push(meditation_experience2);
timeline.push(meditation_experience3);
timeline.push(meditation_experience4);
timeline.push(meditation_experience5);
timeline.push(meditation_experience6);
timeline.push(gen);
timeline.push(age_years);
timeline.push(race);
timeline.push(nativeEng);
timeline.push(edu);
timeline.push(income);
timeline.push(permission);
timeline.push(feedback);
timeline.push(debrief);
timeline.push(exit_fullscreen);

var browser_events = new Array();
jsPsych.init({
	timeline: timeline,
	show_progress_bar: true,
   on_finish: function() {
    document.body.innerHTML = '<p><p><p align="center">Thank you for participating in the study!<p align="center"><b>You will be automatically re-directed to Prolific in a few moments.</b></p>';
    setTimeout(function () { location.href = "https://app.prolific.co/submissions/complete?cc=3F3EE65E" }, 5000)
	},
	on_interaction_data_update: function(data) {
		if (subject_id != '') {
			var browser_event = {
				subject: subject_id,
				version: study_version,
				browser_event: data.event,
				trial: data.trial,
				time: data.time
			}
			save_data(browser_event, 'browser_events');
	  }
	}
});

</script>
</html>
